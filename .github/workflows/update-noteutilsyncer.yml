name: Update README in noteutilsyncer

on:
  push:
    branches:
      - main
    paths:
      - 'README.md'

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Extract repository owner from GITHUB_REPOSITORY
      run: echo "REPO_OWNER=$(echo $GITHUB_REPOSITORY | cut -d '/' -f1)" >> $GITHUB_ENV

    - name: Clone noteutilsyncer repository (if not the current repo)
      if: github.repository != '${{ env.REPO_OWNER }}/noteutilsyncer'
      run: git clone https://github.com/${{ env.REPO_OWNER }}/noteutilsyncer.git

    - name: Set up directory paths
      run: |
        if [[ "${{ github.repository }}" == "${{ env.REPO_OWNER }}/noteutilsyncer" ]]; then
          noteutilsyncer_DIR=$GITHUB_WORKSPACE
        else
          noteutilsyncer_DIR=$GITHUB_WORKSPACE/noteutilsyncer
        fi
        echo "noteutilsyncer_DIR=$noteutilsyncer_DIR" >> $GITHUB_ENV

    - name: Copy README to noteutilsyncer
      run: |
        cp README.md $noteutilsyncer_DIR/READMEs/${{ github.repository_name }}.md

    - name: Commit and push to noteutilsyncer
      run: |
        cd $noteutilsyncer_DIR
        git config user.name "GitHub Action"
        git config user.email "action@github.com"
        git add READMEs/${{ github.repository_name }}.md
        git commit -m "Update README for ${{ github.repository_name }}"
        git push https://${{ secrets.GH_PAT }}@github.com/${{ env.REPO_OWNER }}/noteutilsyncer.git main
